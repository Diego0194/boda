<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Confirma asistencia â€” F&D</title>

  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">

  <style>
    .page-content {
      width:100%;
      max-width:500px;
      margin:0 auto;
      text-align:center;
    }
    input, button {
      width:100%;
      padding:10px;
      margin:10px 0;
      border-radius:8px;
      border:1px solid #ddd;
    }
    .hidden { display:none; }
    .inv-row {
      display:flex;
      align-items:center;
      gap:10px;
      margin-bottom:10px;
      justify-content:flex-start;
    }
    .inv-row span {
      min-width:160px;
      text-align:left;
      white-space:nowrap;
    }
    .inv-row input[type="text"] {
      width:140px;
    }
  </style>

  <link rel="icon" type="image/png" href="media/favicon.png">
</head>

<body>

<header>
  <div class="container header-flex">
    <div class="brand">
      <a href="index.html" style="text-decoration:none;color:inherit;">
        <h1>F&D</h1>
      </a>
      <p class="lead">5 de septiembre de 2026 â€” Espinosa de los Monteros, Burgos</p>
    </div>
    <button class="menu-toggle" aria-label="Abrir menÃº">â˜°</button>
  </div>

  <nav class="nav-links">
    <a href="index.html">ğŸ‘‹ Bienvenidos</a>
    <a href="nosotros.html">â¤ï¸ Nosotros</a>
    <a href="programa.html">ğŸ“† Programa</a>
    <a href="asistencia.html" class="active">âœ… Confirma asistencia</a>
    <a href="direccion.html">ğŸŒ DirecciÃ³n</a>
    <a href="informacion.html">ğŸ“Œ InformaciÃ³n Ãºtil</a>
    <a href="regalos.html">ğŸ Lista de regalos</a>
    <a href="fotos.html">ğŸ“· Fotos de la boda</a>
    <a href="foro.html">ğŸ’¬ Foro</a>
  </nav>
</header>

<main class="page-wrapper">
  <div class="page-container page-content">

    <h2>Confirma tu asistencia</h2>
    <div class="intro">Introduce tu nombre completo para confirmar tu asistencia</div>

    <input id="nombre" placeholder="Nombre y apellidos">
    <button id="buscar">Buscar</button>

    <p id="mensajeError" class="hidden" style="color:#b74d4d;"></p>

    <div id="resultado" class="hidden">

      <p id="mensajeGrupo" class="hidden" style="font-weight:500;">
        Â¿Quieres confirmar algÃºn otro invitado?
      </p>

      <form id="alergenosForm" class="hidden">
        <div id="listaInvitados"></div>

        <button type="submit" id="enviar" class="hidden"
          style="background:#b74d4d;color:white;border:none;border-radius:8px;">
          Enviar
        </button>
      </form>

    </div>

    <div id="mensajeFinal" class="hidden"
      style="color:#b74d4d;font-weight:500;margin-top:20px;"></div>

  </div>
</main>

<footer>
  <div class="container">
    <p>
      Creado con cariÃ±o â€” FÃ¡tima & Diego â€¢ 5 Septiembre 2026<br>
      Contacto: 656573103 (Diego), 670935370 (FÃ¡tima).
    </p>
  </div>
</footer>

<script>
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbz-CYUvkyJ_Ku7u-E-RwWF86FG3cgjM3AOXjc_VjWS8iq2NdOuFKHStRcO7V1vsEOtjIA/exec";
let invitados = [];

fetch(WEB_APP_URL)
  .then(r => r.json())
  .then(d => invitados = d);

const nombreInput = document.getElementById("nombre");
const buscarBtn = document.getElementById("buscar");
const mensajeError = document.getElementById("mensajeError");
const resultado = document.getElementById("resultado");
const mensajeGrupo = document.getElementById("mensajeGrupo");
const lista = document.getElementById("listaInvitados");
const form = document.getElementById("alergenosForm");
const enviarBtn = document.getElementById("enviar");
const mensajeFinal = document.getElementById("mensajeFinal");

buscarBtn.addEventListener("click", () => {
  resetUI();
  const texto = normalizar(nombreInput.value);

  const invitado = invitados.find(i =>
    normalizar(`${i.nombre} ${i.apellido}`) === texto
  );

  if (!invitado) {
    mostrarError("Lo sentimos, tu nombre no estÃ¡ en la lista de invitados.");
    return;
  }

  if (!invitado.grupo && invitado.confirmado) {
    mostrarError("Ya has confirmado anteriormente tu asistencia, ponte en contacto con los novios si necesitas cambiar algo.");
    return;
  }

  resultado.classList.remove("hidden");
  form.classList.remove("hidden");

  if (!invitado.grupo) {
    pintarFila(invitado, true);
    enviarBtn.classList.remove("hidden");
    return;
  }

  const grupo = invitados.filter(i => i.grupo === invitado.grupo);
  const pendientes = grupo.filter(i => !i.confirmado);

  if (!pendientes.length) {
    const nombres = grupo.map(i => `${i.nombre} ${i.apellido}`).join(", ");
    mostrarError(`El grupo ${nombres} ya ha sido confirmado anteriormente.`);
    return;
  }

  mensajeGrupo.classList.remove("hidden");
  pendientes.forEach(i => pintarFila(i, false));
});

function pintarFila(inv, auto) {
  const div = document.createElement("div");
  div.className = "inv-row";

  const cb = document.createElement("input");
  cb.type = "checkbox";
  cb.checked = auto;

  const span = document.createElement("span");
  span.textContent = `${inv.nombre} ${inv.apellido}`;

  const alerg = document.createElement("input");
  alerg.type = "text";
  alerg.placeholder = "AlÃ©rgenos";
  alerg.classList.toggle("hidden", !auto);

  cb.addEventListener("change", () => {
    alerg.classList.toggle("hidden", !cb.checked);
    enviarBtn.classList.toggle(
      "hidden",
      !document.querySelectorAll(".inv-row input[type='che]()
